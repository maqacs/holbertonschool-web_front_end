<!DOCTYPE html>
<html lang="en" dir="ltr">

    <head>

        <meta charset="utf-8" />
        <title>Task 1</title>
        <style>
            
        </style>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
        <script type="application/javascript">
            function buildForm() {
                $("body").append([
                    $('<form></form>').append([
                        $('<div></div>').append([
                            $('<label></label>', { for: 'author', text: 'Author' }),
                            $('<input>', { type: 'text', id: 'author' })
                        ]),
                        $('<div></div>').append([
                            $('<label></label>', { for: 'title', text: 'Title' }),
                            $('<textarea></textarea>', { id: 'title' })
                        ]),
                        $('<input>', { 
                            type: 'submit',
                            on: {
                                click: function () {
                                    sendForm();
                                }
                            } 
                        })
                    ])
                ])
            }
            function sendForm() {
                $("form").after($("<span></span>", {text: "About to send the query to the API"}));
                let postData = {
                    author: $('#author').val(),
                    title: $('#title').val()
                }
                $.post("https://jsonplaceholder.typicode.com/posts", postData, "application/json")
                .done(function(json) {
                    addPostRow(json)
                })
                .fail(function() {
                    alert("Error sending the POST query");
                })
            }
            function addPostRow(data) {
                $("body").append([
                    $("<p></p>").append([
                        $("<span></span>", {text : `Post created with id ${data.id}, title: ${data.title}, author: ${data.author}`})
                    ])
                ]);
            }
            function listPosts() {
                // I couldn't use local host as I didn't have npm installed
                $.get('https://jsonplaceholder.typicode.com/posts', {}, 'json')
                .done(function(json) {
                    $.each(json, function(index, post) {
                        addPostRow(post);
                    })
                })
                .fail(function() {
                    alert("Server Error");
                })
            }
            $(document).ready(function() {
                listPosts();
                buildForm();
            })
        </script>

    </head>

    <body>
        
    </body>

</html>